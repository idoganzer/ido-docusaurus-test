---
title: Firestore Backup
---

<div align="center">    <br/>    <div>DOC</div>    <h1>Firestore Backup</h1>    <br/>  </div>

### Files Used:
📄 cloud/functions/index.js


<br/>

This is our backup cloud function that runs every 72 hours. It outputs all of the Firestore data into the `swimmio_backup` Google cloud storage bucket.
It's possible to filter the backed-up collections using the `collectionIds` parameter, we are setting it to an empty array so it will backup everything.

<div>    📄 cloud/functions/index.js  </div>

```js
🟩 200    const bucket = 'gs://swimmio_backup';
🟩 201    
🟩 202    exports.scheduledFirestoreExport = functions.pubsub.schedule('every 72 hours').onRun((context) => {
🟩 203      const projectId = process.env.GCP_PROJECT || process.env.GCLOUD_PROJECT;
🟩 204      const databaseName = client.databasePath(projectId, '(default)');
🟩 205      return client
🟩 206        .exportDocuments({
🟩 207          name: databaseName,
🟩 208          outputUriPrefix: bucket,
🟩 209          // Leave collectionIds empty to export all collections
🟩 210          // or set to a list of collection IDs to export,
🟩 211          // collectionIds: ['users', 'posts']
🟩 212          collectionIds: [],
🟩 213        })
🟩 214        .then((responses) => {
🟩 215          const response = responses[0];
🟩 216          console.log(`Operation Name: ${response['name']}`);
🟩 217        })
🟩 218        .catch((err) => {
🟩 219          console.error(err);
🟩 220          throw new Error('Export operation failed');
🟩 221        });
🟩 222    });
```
<br/>

The `swimmio_backup` bucket will contain a new object for every backup.

![](https://firebasestorage.googleapis.com/v0/b/swimmio-content/o/repositories%2FveezvxCuzpPrRLLXWD2E%2Fd24729f9-d2d4-4943-931a-25b9b1cc92d0.png?alt=media&token=29b5bf0c-981f-41fc-932a-adf96176098f)

<br/>

Follow these steps to load a backup into a Firestore project:

1.  Install the [gcloud CLI](https://cloud.google.com/sdk/docs/install)
    
2.  Make sure your account has the necessary permissions
    
    1.  On the Firestore project: `Owner`, `Cloud Datastore Owner`, or `Cloud Datastore Import Export Admin`
        
    2.  On the `swimmio_backup` bucket: `Owner` or `Storage Admin`
        
3.  run the command: `gcloud --project=MY_PROJECT firestore import gs://swimmiobackup/BACKUP_OBJECT`
    
    e.g. `gcloud --project=swimm-stag firestore import gs://swimmiobackup/2021-03-31T13:32:5883525`
    
    a successfull output will look like:
    
    ![](https://firebasestorage.googleapis.com/v0/b/swimmio-content/o/repositories%2FveezvxCuzpPrRLLXWD2E%2F94ab0684-faa8-4fe5-af73-119fd5f47004.png?alt=media&token=363eb491-7947-4ee9-a5d6-30ea41d65c32)

<br/>

<br/><br/>

This file was generated by Swimm. [Click here to view it in the app](https://swimm.io/link?l=c3dpbW0lM0ElMkYlMkZyZXBvcyUyRnZlZXp2eEN1enBQclJMTFhXRDJFJTJGZG9jcyUyRk1YQkVFUnJMNzhlUnVwYzFTWDA1). Timestamp: 2021-04-24T18:52:02.177Z
